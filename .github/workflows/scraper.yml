name: MERX Scraper

# Controls when the workflow will run
on:
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
    inputs:
      search_term:
        description: 'Search term for MERX opportunities'
        required: false
        default: 'health'
      max_pages:
        description: 'Maximum number of pages to scrape'
        required: false
        default: '3'
  
  # Optionally run on a schedule (uncomment to enable)
  # schedule:
  #   - cron: '0 9 * * 1'  # Runs every Monday at 9 AM UTC

jobs:
  scrape:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      
      - name: Install Chrome
        run: |
          wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
          sudo sh -c 'echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" >> /etc/apt/sources.list.d/google.list'
          sudo apt-get update
          sudo apt-get install -y google-chrome-stable
      
      - name: Install Python dependencies
        run: |
          pip install --upgrade pip
          pip install selenium requests beautifulsoup4
      
      - name: Run scraper
        run: |
          python scraper.py
        env:
          SEARCH_TERM: ${{ github.event.inputs.search_term || 'health' }}
          MAX_PAGES: ${{ github.event.inputs.max_pages || '3' }}
      
      - name: Upload results
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: scraper-results
          path: |
            /tmp/merx_results.json
            /tmp/merx_*.png
            /tmp/merx_*.html
          retention-days: 7
      
      - name: Display summary
        if: always()
        run: |
          if [ -f /tmp/merx_results.json ]; then
            echo "✓ Scraping completed successfully!"
            echo "Results:"
            cat /tmp/merx_results.json | python -m json.tool | head -50
          else
            echo "⚠ No results file found"
          fi
